repo: github.com/amida-tech/DRE
mount: /dre

image: node

depends:
  services:
    - persistentMongo
    - persistentRedis

host_forwarding:
  - host_name: dre.amida.com
    host_port: 80
    container_port: 3000

commands:
  once:
    - npm install -g grunt-cli
    - npm install -g bower
    - npm install -g mocha
    - npm install --quiet
    - bower install
  always:
    - node server

compose:
  environment:
    APP_NAME: DRE
    MONGO_HOST: persistentMongo

test:
  image: node
  once:
    - npm install -g grunt-cli
    - npm install -g bower
    - npm install -g mocha
    - npm install --quiet
    - bower install
  suites:
    - name: test
      command:
        - grunt
      services:
        - persistentMongo
        - persistentRedis
      description: Run DRE tests